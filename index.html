<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- Content Security Policy - Bank-Grade Protection -->
        <!-- CSP Reporting: To enable violation reports, add report-uri https://your-endpoint.com/csp-report -->
        <meta http-equiv="Content-Security-Policy" 
              content="default-src 'self'; 
                       script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://api.anthropic.com; 
                       style-src 'self' 'unsafe-inline'; 
                       img-src 'self' data: https:; 
                       font-src 'self' data:; 
                       connect-src 'self' 
                         https://manga-auth-worker.nuranantoadhien.workers.dev 
                         https://manga-code-validator.nuranantoadhien.workers.dev 
                         https://decrypt-manifest.nuranantoadhien.workers.dev
                         https://profile-worker.nuranantoadhien.workers.dev
                         https://cdn.jsdelivr.net
                         https://unpkg.com
                         https://cdnjs.cloudflare.com
                         https://script.google.com 
                         https://*.googleusercontent.com 
                         https://raw.githubusercontent.com 
                         https://images.weserv.nl
                         https://api.anthropic.com;
                       form-action 'self' https://manga-auth-worker.nuranantoadhien.workers.dev;
                       frame-ancestors 'none';
                       upgrade-insecure-requests;
                       base-uri 'self';">
        <!-- Security Headers -->
        <meta http-equiv="X-Content-Type-Options" content="nosniff">
        <meta http-equiv="X-Frame-Options" content="DENY">
        <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
        <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=()">
        <!-- HSTS: Strict-Transport-Security configured in Cloudflare Worker responses -->
        <meta name="robots" content="noindex, nofollow" />
        <meta name="googlebot" content="noindex, nofollow" />
        <meta
            name="description"
            content="Nurananto Scanlation - Baca manga terjemahan bahasa Indonesia gratis"
        />
        <title>Nurananto Scanlation</title>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="assets/Webicon/favicon.ico" />
        <link rel="icon" type="image/svg+xml" href="assets/Webicon/favicon.svg" />
        <link rel="icon" type="image/png" sizes="96x96" href="assets/Webicon/favicon-96x96.png" />
        <link rel="apple-touch-icon" sizes="180x180" href="assets/Webicon/apple-touch-icon.png" />

        <!-- Preconnect -->
        <link rel="preconnect" href="https://raw.githubusercontent.com" />
        <link rel="dns-prefetch" href="https://raw.githubusercontent.com" />
        <link rel="preconnect" href="https://images.weserv.nl" />
        <link rel="dns-prefetch" href="https://images.weserv.nl" />

        <!-- ✅ FIX: Blocking CSS untuk prevent FOUC saat hard refresh -->
        <link rel="stylesheet" href="style.css?v=20260220e" />

        <!-- Critical CSS inline -->
        <!-- Critical CSS inline -->
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                margin: 0;
                padding: 1.25rem;
                padding-bottom: 100px;
                background: #0a0a0a;
                color: #fff;
                /* ✅ FIX: Explicit font-size untuk prevent glitch */
                font-size: 16px;
                font-family:
                    "Rounded Mplus 1c", "M PLUS Rounded 1c", "Varela Round",
                    "Nunito", "Comfortaa", "Quicksand", "Segoe UI", sans-serif;
                /* ✅ FIX: Prevent flash saat CSS ter-load */
                opacity: 1;
                transition: opacity 0.2s ease;
            }

            header {
                max-width: 1400px;
                margin: 0 auto 1.5rem;
                padding: 0;
                background: #0a0a0a;
                box-shadow: none;
                border-bottom: none;
            }

            .header-content {
                max-width: 1400px;
                margin: 0 auto;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .site-logo {
                height: 60px;
                width: auto;
                display: block;
            }

            .header-buttons {
                display: flex;
                gap: 12px;
                align-items: center;
            }

            .github-link-header,
            .facebook-link-header {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 16px;
                border-radius: 8px;
                text-decoration: none;
            }

            .github-link-header {
                background: #24292e;
            }

            .facebook-link-header {
                background: #1877f2;
            }

            .github-icon,
            .facebook-icon {
                width: 24px;
                height: 24px;
            }

            .github-text,
            .facebook-text {
                color: #fff;
                font-weight: 600;
                font-size: 14px;
            }

            .search-section {
                max-width: 1400px;
                margin: 0 auto 2.5rem;
                padding: 0;
            }

            .manga-list-section {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0;
            }

            .manga-list-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
                padding: 0;
            }

            .manga-list-heading {
                font-size: clamp(1.5rem, 4vw, 2rem);
                font-weight: 700;
                color: #fff;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin: 0;
                padding: 0;
                flex-shrink: 0;
                line-height: 1;
            }

            #searchInput {
                width: 100%;
                padding: 0.75rem 1.25rem;
                font-size: 1rem;
                border-radius: 12px;
                border: 2px solid rgba(255, 255, 255, 0.1);
                outline: none;
                background: #222;
                color: #fff;
            }

            #searchInput::placeholder {
                color: #888;
            }

            .manga-list-container {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                padding: 0;
                max-width: 1400px;
                margin: 0 auto;
            }

            .manga-list-page {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .pagination-container {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 1.5rem;
                margin-top: 2rem;
                padding: 1rem;
            }

            .pagination-btn {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                background: rgba(24, 119, 242, 0.1);
                border: 2px solid rgba(24, 119, 242, 0.3);
                border-radius: 12px;
                color: #1877f2;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .pagination-btn:hover:not(:disabled) {
                background: rgba(24, 119, 242, 0.2);
                border-color: #1877f2;
                transform: translateY(-2px);
            }

            .pagination-btn:disabled {
                opacity: 0.3;
                cursor: not-allowed;
            }

            .pagination-btn svg {
                width: 20px;
                height: 20px;
            }

            .page-indicator {
                font-size: 1rem;
                font-weight: 600;
                color: #fff;
                padding: 0.5rem 1rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
            }

            .empty-state {
                width: 100%;
                min-height: 300px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                padding: 2rem;
            }

            .empty-state p {
                margin: 0.5rem 0;
            }

            /* ✅ FIXED: Background & Shadow Transparent */
            .manga-card {
                position: relative;
                overflow: hidden;
                background: transparent;
                border-radius: 0.8rem;
                border: 1px solid rgba(255, 255, 255, 0.15);
                padding: 0.5rem;
                box-shadow: 0 4px 15px rgba(255, 255, 255, 0.05);
                cursor: pointer;
                transition:
                    transform 0.3s ease,
                    box-shadow 0.3s ease;
                display: flex;
                flex-direction: column;
                height: 100%;
                min-height: 0;
            }

            .manga-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
            }

            .manga-cover-wrapper {
                position: relative;
                width: 100%;
                overflow: hidden;
                aspect-ratio: 3/4.2;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 0.6rem;
                flex: 0 0 auto;
            }

            /* Type badge di manga card sama seperti trending */
            .manga-cover-wrapper .type-badge {
                bottom: 0;
                right: 0;
                border-radius: 0.6rem 0 0.6rem 0;
            }

            .manga-card img,
            .manga-cover-wrapper img {
                width: 100%;
                max-width: 100%; /* ✅ FIX: Prevent overflow */
                height: 100%; /* ✅ FIX: Fill container height */
                object-fit: cover;
                object-position: center; /* ✅ FIX: Center image untuk better crop */
                border-radius: 0.6rem;
                display: block;
                background: transparent;
                /* ✅ FIX: Prevent image scaling issues */
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
                image-rendering: auto;
            }

            /* Type Badge Base Styles */
            .type-badge {
                position: absolute;
                bottom: 0;
                right: 0;
                padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px);
                border-radius: 0.6rem 0 0.6rem 0;
                /* ✅ FIX: Fallback font-size untuk prevent glitch saat hard refresh */
                font-size: 12px; /* Fallback untuk browser yang belum support clamp() */
                font-size: clamp(11px, 2vw, 13px); /* Preferred dengan clamp() */
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: #fff;
                z-index: 5;
                pointer-events: none;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
                line-height: 1.2;
                white-space: nowrap;
                display: flex;
                align-items: center;
                gap: clamp(4px, 1vw, 6px);
                /* ✅ FIX: Prevent font-size glitch dengan max-width */
                max-width: 100%;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* Badge untuk B/W (Manga Hitam Putih) */
            .type-badge-bw {
                background: #1a1a1a;
                background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            /* Badge untuk Colour (Webtoon Berwarna) */
            .type-badge-colour {
                background: #0d5fcc;
                background: linear-gradient(135deg, #1877f2 0%, #0d5fcc 100%);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }

            /* Badge untuk Novel */
            .type-badge-novel {
                background: #8b5cf6;
                background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }

            .type-badge-icon {
                width: 14px; /* Fallback */
                width: clamp(12px, 2.5vw, 16px); /* Preferred */
                height: 14px; /* Fallback */
                height: clamp(12px, 2.5vw, 16px); /* Preferred */
                flex-shrink: 0;
                stroke: currentColor;
            }

            .type-badge-text {
                line-height: 1;
                /* ✅ FIX: Prevent text glitch dengan explicit font-size */
                font-size: inherit;
            }

            /* ✅ Status badge di pojok kiri atas (seperti trending badge) */
            .status-badge {
                position: absolute;
                top: 0;
                left: 0;
                padding: 6px 14px;
                border-radius: 0.6rem 0 0.6rem 0;
                font-size: 12px;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: #fff;
                z-index: 2;
                display: flex;
                align-items: center;
                gap: 5px;
                pointer-events: none;
                white-space: nowrap;
            }

            .status-badge-updated {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
            }

            .status-badge-ongoing {
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
            }

            .status-badge-end {
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            }

            .status-badge-hiatus {
                background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
                box-shadow: 0 2px 8px rgba(107, 114, 128, 0.4);
            }

            .badge-icon {
                width: 14px;
                height: 14px;
                flex-shrink: 0;
            }

            /* Mobile responsive untuk status badge */
            @media (max-width: 600px) {
                .status-badge {
                    padding: 2.5px 6px;
                    font-size: 8.5px;
                    gap: 2.5px;
                }
                .badge-icon {
                    width: 9px;
                    height: 9px;
                }
            }

            /* ✅ Title manga - urutan pertama setelah cover */
            .manga-title {
                color: #fff;
                padding: 0.6rem 0.4rem 0;
                text-align: left;
                font-size: 1rem;
                font-weight: 600;
                line-height: 1.4;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                min-height: 1.4em;
                flex: 0 0 auto;
                order: 1;
            }

            /* ✅ Info bar di bawah title - urutan kedua setelah title */
            .manga-info-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0.5rem 0.3rem;
                gap: 0.5rem;
                margin-top: 0;
                flex: 0 0 auto;
                order: 2;
            }

            .manga-chapter {
                color: #fff;
                font-size: 0.75rem;
                font-weight: 700;
            }

            .manga-time {
                color: #888;
                font-size: 0.8rem;
                font-weight: 600;
            }

            /* ============================================
               MANGA CARD HORIZONTAL (New List Layout)
               ============================================ */
            .manga-card-horizontal {
                display: flex;
                flex-direction: column;
                background: rgba(255, 255, 255, 0.02);
                border: 2px solid rgba(255, 255, 255, 0.12);
                border-radius: 12px;
                padding: 1rem;
                gap: 0;
                transition: all 0.3s ease;
                position: relative;
            }

            .manga-card-horizontal:hover {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(24, 119, 242, 0.4);
                box-shadow: 0 4px 20px rgba(24, 119, 242, 0.15);
            }

            .manga-card-title-link {
                text-decoration: none;
                color: inherit;
                display: flex;
                align-items: center;
                margin: 0;
                padding: 0 0 0.75rem 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                margin-bottom: 0.75rem;
                min-height: 1.4rem;
            }

            .manga-card-title-text {
                font-size: 1.125rem;
                font-weight: 700;
                color: #fff;
                line-height: 1.2;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                margin: 0;
                padding: 0;
                text-align: left;
                display: block;
            }

            .manga-card-content {
                display: flex;
                gap: 1rem;
                align-items: flex-start;
            }

            .manga-card-cover-link {
                flex-shrink: 0;
                width: 120px;
                display: block;
                position: relative;
                border-radius: 8px;
                overflow: hidden;
                align-self: flex-start;
            }

            .manga-card-cover-img {
                width: 100%;
                height: auto;
                aspect-ratio: 3/4.2;
                object-fit: cover;
                display: block;
                border-radius: 8px;
                transition: transform 0.3s ease;
                background: #1a1a1a;
            }

            .manga-card-cover-link:hover .manga-card-cover-img {
                transform: scale(1.05);
            }

            .manga-card-chapters {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                min-width: 0;
                padding: 0;
                margin: 0;
                align-self: stretch;
                justify-content: flex-start;
            }

            .manga-chapter-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 0.75rem;
                padding: 0.65rem 0.75rem;
                border: 1.5px solid rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                text-decoration: none;
                color: inherit;
                transition: all 0.3s ease;
                flex-shrink: 0;
                background: rgba(255, 255, 255, 0.02);
            }
            
            .manga-chapter-item:first-child {
                margin-top: 0;
            }
            
            .manga-chapter-item:last-child {
                margin-bottom: 0;
            }

            .manga-chapter-item:hover {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(24, 119, 242, 0.4);
                transform: translateX(2px);
            }

            .manga-chapter-left {
                display: flex;
                align-items: center;
                gap: 0.4rem;
                flex: 1;
                min-width: 0;
            }

            .manga-chapter-text {
                font-size: 1rem;
                font-weight: 600;
                color: #fff;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.2;
            }

            .manga-chapter-item:hover .manga-chapter-text {
                color: #1877f2;
            }

            .manga-chapter-badge {
                display: inline-flex;
                align-items: center;
                gap: 3px;
                padding: 2px 6px;
                background: linear-gradient(135deg, rgba(24, 119, 242, 0.2) 0%, rgba(10, 91, 214, 0.2) 100%);
                border: 1px solid rgba(24, 119, 242, 0.3);
                border-radius: 4px;
                font-size: 0.7rem;
                font-weight: 700;
                color: #1877f2;
                text-transform: uppercase;
                white-space: nowrap;
                line-height: 1;
            }

            .manga-chapter-badge svg {
                width: 11px;
                height: 11px;
                flex-shrink: 0;
            }

            /* Badge UP - Glowing Blue */
            .manga-chapter-badge-up {
                display: inline-flex;
                align-items: center;
                gap: 3px;
                padding: 2px 6px;
                background: linear-gradient(135deg, #1877f2 0%, #0a5bd6 100%);
                border: 1px solid rgba(24, 119, 242, 0.5);
                border-radius: 4px;
                font-size: 0.7rem;
                font-weight: 700;
                color: #fff;
                text-transform: uppercase;
                white-space: nowrap;
                line-height: 1;
                flex-shrink: 0;
                box-shadow: 0 0 8px rgba(24, 119, 242, 0.6),
                            0 0 16px rgba(24, 119, 242, 0.4);
                animation: badge-up-glow 2s ease-in-out infinite;
            }

            @keyframes badge-up-glow {
                0%, 100% {
                    box-shadow: 0 0 8px rgba(24, 119, 242, 0.6),
                                0 0 16px rgba(24, 119, 242, 0.4);
                }
                50% {
                    box-shadow: 0 0 12px rgba(24, 119, 242, 0.8),
                                0 0 24px rgba(24, 119, 242, 0.6),
                                0 0 32px rgba(24, 119, 242, 0.4);
                }
            }

            .manga-chapter-badge-up svg {
                width: 11px;
                height: 11px;
                flex-shrink: 0;
            }

            /* Badge END - Red (same as info-manga) */
            .manga-chapter-badge-end {
                display: inline-flex;
                align-items: center;
                padding: 2px 6px;
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
                border-radius: 4px;
                font-size: 0.7rem;
                font-weight: 700;
                color: #fff;
                text-transform: uppercase;
                white-space: nowrap;
                line-height: 1;
                flex-shrink: 0;
                box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
            }

            /* Badge HIATUS - Gray (same as info-manga) */
            .manga-chapter-badge-hiatus {
                display: inline-flex;
                align-items: center;
                padding: 2px 6px;
                background: linear-gradient(135deg, #757575 0%, #616161 100%);
                border-radius: 4px;
                font-size: 0.7rem;
                font-weight: 700;
                color: #fff;
                text-transform: uppercase;
                white-space: nowrap;
                line-height: 1;
                flex-shrink: 0;
                box-shadow: 0 2px 4px rgba(117, 117, 117, 0.3);
            }

            .manga-chapter-time {
                font-size: 0.9rem;
                font-weight: 500;
                color: #888;
                white-space: nowrap;
                flex-shrink: 0;
                line-height: 1.2;
            }

            .manga-chapter-item:hover .manga-chapter-time {
                color: #aaa;
            }

            .visually-hidden {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border-width: 0;
            }

            .skip-link {
                position: absolute;
                top: -40px;
                left: 0;
                background: #1877f2;
                color: #fff;
                padding: 8px 16px;
                text-decoration: none;
                z-index: 100;
                border-radius: 0 0 4px 0;
            }

            .skip-link:focus {
                top: 0;
            }

            /* Desktop Besar - No specific adjustments needed for horizontal cards */
@media (min-width: 1400px) {
    /* Desktop Large - 2 Column Grid */
    .manga-list-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        max-width: 1400px;
        box-sizing: border-box;
        width: 100%;
    }
    
    .manga-list-page {
        display: contents;
    }
    
    /* Ensure all cards in any page get the same styling */
    .manga-card-horizontal,
    .manga-list-page .manga-card-horizontal {
        max-width: 100%;
        width: 100%;
        min-width: 0;
        box-sizing: border-box;
        padding: 0.85rem !important;
        overflow: hidden;
    }
    
    .manga-card-title-link,
    .manga-list-page .manga-card-title-link {
        padding: 0 0 0.65rem 0 !important;
        margin-bottom: 0.65rem !important;
        min-width: 0;
    }
    
    .manga-card-title-text,
    .manga-list-page .manga-card-title-text {
        font-size: 1.05rem !important;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }
    
    .manga-card-content,
    .manga-list-page .manga-card-content {
        gap: 0.9rem !important;
        min-width: 0;
        overflow: hidden;
    }
    
    .manga-card-cover-link,
    .manga-list-page .manga-card-cover-link {
        width: 100px !important;
        flex-shrink: 0;
    }
    
    .manga-card-chapters,
    .manga-list-page .manga-card-chapters {
        min-width: 0;
        overflow: hidden;
        flex: 1;
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.5rem;
    }
    
    /* Chapter spacing for desktop large */
    .manga-chapter-item,
    .manga-list-page .manga-chapter-item {
        padding: 0.7rem 0.8rem !important;
        margin-bottom: 0 !important;
        min-width: 0;
        flex-shrink: 0;
        border-radius: 12px;
    }
    
    .manga-chapter-item:first-child,
    .manga-list-page .manga-chapter-item:first-child {
        margin-top: 0 !important;
    }
    
    .manga-chapter-left,
    .manga-list-page .manga-chapter-left {
        min-width: 0;
        overflow: hidden;
    }
    
    /* Font sizes for desktop large */
    .manga-chapter-text,
    .manga-list-page .manga-chapter-text {
        font-size: 1rem !important;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }
    
    .manga-chapter-time,
    .manga-list-page .manga-chapter-time {
        font-size: 0.88rem !important;
        flex-shrink: 0;
    }
    
    .manga-chapter-badge,
    .manga-chapter-badge-up,
    .manga-chapter-badge-end,
    .manga-chapter-badge-hiatus,
    .manga-list-page .manga-chapter-badge,
    .manga-list-page .manga-chapter-badge-up,
    .manga-list-page .manga-chapter-badge-end,
    .manga-list-page .manga-chapter-badge-hiatus {
        font-size: 0.68rem !important;
        padding: 2px 6px !important;
        flex-shrink: 0;
    }
    
    .manga-chapter-badge svg,
    .manga-chapter-badge-up svg,
    .manga-list-page .manga-chapter-badge svg,
    .manga-list-page .manga-chapter-badge-up svg {
        width: 11px !important;
        height: 11px !important;
    }
}

/* Desktop Sedang */
@media (min-width: 1024px) and (max-width: 1399px) {
    /* Desktop Medium - 2 Column Grid */
    .manga-list-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        max-width: 1400px;
        box-sizing: border-box;
        width: 100%;
    }
    
    .manga-list-page {
        display: contents;
    }
    
    /* Ensure all cards in any page get the same styling */
    .manga-card-horizontal,
    .manga-list-page .manga-card-horizontal {
        max-width: 100%;
        width: 100%;
        min-width: 0;
        box-sizing: border-box;
        padding: 0.8rem !important;
        overflow: hidden;
    }
    
    .manga-card-title-link,
    .manga-list-page .manga-card-title-link {
        padding: 0 0 0.6rem 0 !important;
        margin-bottom: 0.6rem !important;
        min-width: 0;
    }
    
    .manga-card-title-text,
    .manga-list-page .manga-card-title-text {
        font-size: 1rem !important;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }
    
    .manga-card-content,
    .manga-list-page .manga-card-content {
        gap: 0.85rem !important;
        min-width: 0;
        overflow: hidden;
    }
    
    .manga-card-cover-link,
    .manga-list-page .manga-card-cover-link {
        width: 95px !important;
        flex-shrink: 0;
    }
    
    .manga-card-chapters,
    .manga-list-page .manga-card-chapters {
        min-width: 0;
        overflow: hidden;
        flex: 1;
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.5rem;
    }
    
    /* Chapter spacing for desktop medium */
    .manga-chapter-item,
    .manga-list-page .manga-chapter-item {
        padding: 0.65rem 0.75rem !important;
        margin-bottom: 0 !important;
        min-width: 0;
        flex-shrink: 0;
        border-radius: 11px;
    }
    
    .manga-chapter-item:first-child,
    .manga-list-page .manga-chapter-item:first-child {
        margin-top: 0 !important;
    }
    
    .manga-chapter-left,
    .manga-list-page .manga-chapter-left {
        min-width: 0;
        overflow: hidden;
    }
    
    /* Font sizes for desktop medium */
    .manga-chapter-text,
    .manga-list-page .manga-chapter-text {
        font-size: 0.95rem !important;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }
    
    .manga-chapter-time,
    .manga-list-page .manga-chapter-time {
        font-size: 0.85rem !important;
        flex-shrink: 0;
    }
    
    .manga-chapter-badge,
    .manga-chapter-badge-up,
    .manga-chapter-badge-end,
    .manga-chapter-badge-hiatus,
    .manga-list-page .manga-chapter-badge,
    .manga-list-page .manga-chapter-badge-up,
    .manga-list-page .manga-chapter-badge-end,
    .manga-list-page .manga-chapter-badge-hiatus {
        font-size: 0.65rem !important;
        padding: 2px 5px !important;
        flex-shrink: 0;
    }
    
    .manga-chapter-badge svg,
    .manga-chapter-badge-up svg,
    .manga-list-page .manga-chapter-badge svg,
    .manga-list-page .manga-chapter-badge-up svg {
        width: 10px !important;
        height: 10px !important;
    }
}

/* iPad Air - Specific responsive adjustments */
@media (min-width: 820px) and (max-width: 1023px) {
    .site-logo {
        height: 50px;
    }
    .header-buttons {
        gap: 10px;
    }
    .github-link-header,
    .facebook-link-header {
        padding: 10px 18px;
    }
    .github-icon,
    .facebook-icon {
        width: 24px;
        height: 24px;
    }
    .github-text,
    .facebook-text {
        font-size: 14px;
    }
    
    /* iPad Air - Single Column */
    .manga-list-container {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }
    
    /* iPad Air Card Sizing */
    .manga-card-horizontal {
        padding: 1.2rem;
    }
    
    .manga-card-title-link {
        padding: 0 0 0.85rem 0;
        margin-bottom: 0.85rem;
    }
    
    .manga-card-content {
        gap: 1.2rem;
    }
    
    .manga-card-cover-link {
        width: 130px;
    }
    
    .manga-card-chapters {
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.5rem;
    }
    
    /* iPad Air - Increased Chapter Spacing */
    .manga-chapter-item {
        padding: 0.7rem 0.8rem;
        margin-bottom: 0;
        flex-shrink: 0;
        border-radius: 12px;
    }
    
    /* iPad Air - Font sizes */
    .manga-chapter-text {
        font-size: 1.1rem;
    }
    
    .manga-chapter-time {
        font-size: 0.95rem;
    }
    
    .manga-chapter-badge,
    .manga-chapter-badge-up,
    .manga-chapter-badge-end,
    .manga-chapter-badge-hiatus {
        font-size: 0.75rem;
        padding: 3px 7px;
    }
    
    .manga-chapter-badge svg,
    .manga-chapter-badge-up svg {
        width: 12px;
        height: 12px;
    }
}

/* Tablet (smaller than iPad Air) */
@media (min-width: 768px) and (max-width: 819px) {
    .site-logo {
        height: 50px;
    }
    .header-buttons {
        gap: 8px;
    }
    .github-link-header,
    .facebook-link-header {
        padding: 8px 16px;
    }
    .github-icon,
    .facebook-icon {
        width: 24px;
        height: 24px;
    }
    .github-text,
    .facebook-text {
        font-size: 14px;
    }
    
    /* Tablet - Single Column */
    .manga-list-container {
        display: flex;
        flex-direction: column;
    }
    
    .manga-card-chapters {
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.45rem;
    }
    
    /* Horizontal Card Chapter Spacing for Tablet */
    .manga-chapter-item {
        padding: 0.6rem 0.7rem;
        flex-shrink: 0;
        border-radius: 11px;
    }
}

@media (max-width: 767px) {
    body {
        padding: 20px;
        padding-bottom: 110px;
    }
    header {
        margin-bottom: 1rem;
    }
    .site-logo {
        height: 45px;
    }
    .search-section {
        padding: 0;
    }
    #searchInput {
        padding: 0.65rem 1rem;
        font-size: 0.95rem;
    }
    /* Hide desktop buttons on mobile - Show login button only */
    .header-buttons {
        display: flex !important;
    }
    
    /* Horizontal Card Responsive */
    .manga-card-horizontal {
        padding: 0.75rem;
    }
    
    .manga-card-title-link {
        padding: 0 0 0.6rem 0;
        margin-bottom: 0.6rem;
    }
    
    .manga-card-title-text {
        font-size: 1rem;
    }
    
    .manga-card-cover-link {
        width: 100px;
        align-self: flex-start;
    }
    
    .manga-card-content {
        align-items: flex-start;
    }
    
    .manga-card-chapters {
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.5rem;
    }
    
    .manga-chapter-item {
        flex-shrink: 0;
        padding: 0.6rem 0.7rem;
        border-radius: 11px;
    }
    
    .manga-chapter-text {
        font-size: 1rem;
    }
    
    .manga-chapter-time {
        font-size: 0.9rem;
    }
    
    .manga-chapter-badge {
        font-size: 0.7rem;
        padding: 2px 6px;
    }
    
    .manga-chapter-badge svg {
        width: 11px;
        height: 11px;
    }
    
    .pagination-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        gap: 0.35rem;
    }
    
    .pagination-btn svg {
        width: 18px;
        height: 18px;
    }
    
    .page-indicator {
        font-size: 0.9rem;
        padding: 0.4rem 0.75rem;
    }
}

@media (max-width: 480px) {
    body {
        padding: 20px;
        padding-bottom: 105px;
    }
    .site-logo {
        height: 40px;
    }
    .github-link-header,
    .facebook-link-header {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
        border-radius: 8px;
    }
    .github-icon,
    .facebook-icon {
        width: 22px;
        height: 22px;
    }
    
    /* Horizontal Card Mobile */
    .manga-card-horizontal {
        padding: 0.65rem;
    }
    
    .manga-card-title-link {
        padding: 0 0 0.5rem 0;
        margin-bottom: 0.5rem;
    }
    
    .manga-card-title-text {
        font-size: 0.95rem;
    }
    
    .manga-card-cover-link {
        width: 85px;
        align-self: flex-start;
    }
    
    .manga-card-content {
        gap: 0.75rem;
        align-items: flex-start;
    }
    
    .manga-card-chapters {
        align-self: stretch;
        justify-content: flex-start;
        gap: 0.45rem;
    }
    
    .manga-chapter-item {
        flex-shrink: 0;
        padding: 0.55rem 0.65rem;
        border-radius: 10px;
    }
    
    .manga-chapter-text {
        font-size: 0.85rem;
    }
    
    .manga-chapter-time {
        font-size: 0.75rem;
    }
    
    .manga-chapter-badge {
        font-size: 0.65rem;
        padding: 2px 5px;
    }
    
    .manga-chapter-badge svg {
        width: 10px;
        height: 10px;
    }
    
    .pagination-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
        gap: 0.3rem;
    }
    
    .pagination-btn span {
        display: none;
    }
    
    .pagination-btn svg {
        width: 20px;
        height: 20px;
    }
    
    .page-indicator {
        font-size: 0.85rem;
        padding: 0.35rem 0.6rem;
    }
}

.loading-indicator {
    text-align: center;
    padding: 40px 20px;
    display: none;
}

.loading-indicator.show {
    display: block;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #1877f2;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

@media (max-width: 399px) {
    body {
        padding: 15px;
        padding-bottom: 100px;
    }
    
    /* Horizontal Card Extra Small */
    .manga-card-horizontal {
        padding: 0.5rem;
    }
    
    .manga-card-title-link {
        padding: 0 0 0.4rem 0;
        margin-bottom: 0.4rem;
    }
    
    .manga-card-title-text {
        font-size: 0.85rem;
    }
    
    .manga-card-cover-link {
        width: 75px;
        align-self: center;
    }
    
    .manga-card-content {
        gap: 0.6rem;
        align-items: center;
    }
    
    .manga-card-chapters {
        align-self: flex-start;
    }
    
    .manga-chapter-item {
        padding: 0 0 0.3rem 0;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
    }
    
    .manga-chapter-item:first-child {
        padding-top: 0;
    }
    
    .manga-chapter-text {
        font-size: 0.8rem;
    }
    
    .manga-chapter-time {
        font-size: 0.7rem;
    }
    
    .manga-chapter-badge {
        font-size: 0.6rem;
        padding: 1px 4px;
    }
    
    .manga-chapter-badge svg {
        width: 9px;
        height: 9px;
    }
    
    .manga-chapter-badge {
        font-size: 0.55rem;
        padding: 1px 3px;
    }
    
    .manga-chapter-badge svg {
        width: 8px;
        height: 8px;
    }
    
    .pagination-container {
        gap: 0.75rem;
        margin-top: 1.5rem;
        padding: 0.75rem;
    }
    
    .pagination-btn {
        padding: 0.45rem 0.6rem;
        font-size: 0.8rem;
    }
    
    .page-indicator {
        font-size: 0.75rem;
        padding: 0.3rem 0.5rem;
    }
}

/* ========================================
   TRENDING SECTION
   ======================================== */
.trending-section {
    max-width: 1400px;
    margin: 0 auto 2.5rem;
    padding: 0;
}

.trending-container {
    width: 100%;
    display: flex;
    gap: 0;
    padding: 0;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    cursor: grab;
    user-select: none;
}

.trending-container.is-dragging {
    cursor: grabbing;
    scroll-snap-type: none;
    scroll-behavior: auto;
}

.trending-container.is-dragging * {
    cursor: grabbing;
    user-select: none;
    pointer-events: none;
}

.trending-container::-webkit-scrollbar {
    display: none;
}

/* Trending Card - Landscape Layout */
.trending-card {
    flex: 0 0 100%;
    display: flex;
    gap: 1.5rem;
    width: 100%;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: clamp(1rem, 2vw, 1.5rem);
    scroll-snap-align: start;
    scroll-snap-stop: always;
    box-sizing: border-box;
    transition: all 0.3s ease;
    cursor: pointer;
    user-select: none;
}

.trending-card * {
    user-select: none;
    -webkit-user-drag: none;
}

.trending-card:hover {
    border-color: rgba(255, 255, 255, 0.25);
    background: rgba(255, 255, 255, 0.03);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* Left Content Area */
.trending-card-left {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    min-width: 0;
}

/* Trending Badges Container */
.trending-badges-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    margin-bottom: 0.5rem;
}

/* Trending Badge 24 Jam */
.trending-24h-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    color: #fff;
    border-radius: 6px;
    font-size: clamp(0.7rem, 1vw, 0.8rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    width: fit-content;
    box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
    min-height: 30px;
    line-height: 1;
}

.trending-24h-icon {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
    display: block;
}

/* Right Cover Area */
.trending-card-right {
    flex-shrink: 0;
    width: 180px;
    aspect-ratio: 3/4.2;
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
}

.trending-card-cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
    transition: transform 0.3s ease;
}

.trending-card:hover .trending-card-cover {
    transform: scale(1.05);
}

/* Title */
.trending-card-title {
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    font-weight: 700;
    color: #fff;
    line-height: 1.3;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin: 0;
}

/* Genres */
.trending-card-genres {
    font-size: clamp(0.7rem, 1vw, 0.8rem);
    color: rgba(255, 255, 255, 0.6);
    line-height: 1.4;
}

/* Synopsis Label */
.trending-card-synopsis-label {
    font-size: clamp(0.75rem, 1vw, 0.85rem);
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    margin: 0.25rem 0 0.25rem 0;
}

/* Synopsis Text */
.trending-card-synopsis {
    font-size: clamp(0.7rem, 1vw, 0.8rem);
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: justify;
}

/* Status Badge */
.trending-status-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: clamp(0.7rem, 1vw, 0.8rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-height: 30px;
    line-height: 1;
}

/* Same colors as info-manga.css */
.trending-status-badge.status-ongoing {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.75) 0%, rgba(22, 163, 74, 0.75) 100%);
    color: #fff;
}

.trending-status-badge.status-hiatus {
    background: linear-gradient(135deg, rgba(107, 114, 128, 0.75) 0%, rgba(75, 85, 99, 0.75) 100%);
    color: #fff;
}

.trending-status-badge.status-completed,
.trending-status-badge.status-tamat {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.75) 0%, rgba(185, 28, 28, 0.75) 100%);
    color: #fff;
}

/* Responsive Trending Section */
@media (max-width: 1024px) {
    .trending-card-right {
        width: 150px;
    }
}

@media (max-width: 768px) {
    .trending-section {
        margin-bottom: 2rem;
    }
    
    .trending-card {
        flex: 0 0 100%;
        gap: 1rem;
    }
    
    .trending-card-right {
        width: 120px;
        aspect-ratio: 3/4.2;
        align-self: center;
    }
    
    .trending-card-cover {
        object-fit: contain;
    }
    
    .trending-badges-container {
        flex-wrap: nowrap;
        gap: 6px;
    }
    
    .trending-24h-badge {
        padding: 4px 8px;
        font-size: 0.65rem;
        gap: 4px;
        min-height: 24px;
    }
    
    .trending-24h-icon {
        width: 10px;
        height: 10px;
    }
    
    .trending-status-badge {
        padding: 4px 8px;
        font-size: 0.65rem;
        min-height: 24px;
    }
    
    .trending-card-title {
        font-size: 1.1rem;
    }
    
    .trending-card-genres {
        font-size: 0.7rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .trending-card-synopsis-label {
        font-size: 0.75rem;
    }
    
    .trending-card-synopsis {
        font-size: 0.7rem;
        -webkit-line-clamp: 2;
    }
}

@media (max-width: 480px) {
    .trending-card {
        flex: 0 0 100%;
        padding: 1rem;
    }
    
    .trending-card-right {
        width: 100px;
        aspect-ratio: 3/4.2;
        align-self: center;
    }
    
    .trending-card-cover {
        object-fit: contain;
    }
    
    .trending-badges-container {
        flex-wrap: nowrap;
        gap: 4px;
    }
    
    .trending-24h-badge {
        padding: 3px 6px;
        font-size: 0.6rem;
        gap: 3px;
        letter-spacing: 0.3px;
        min-height: 22px;
    }
    
    .trending-24h-icon {
        width: 9px;
        height: 9px;
    }
    
    .trending-status-badge {
        padding: 3px 6px;
        font-size: 0.6rem;
        letter-spacing: 0.3px;
        min-height: 22px;
    }
    
    .trending-card-title {
        font-size: 1rem;
    }
    
    .trending-card-genres {
        font-size: 0.65rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .trending-card-synopsis-label {
        font-size: 0.7rem;
    }
    
    .trending-card-synopsis {
        font-size: 0.65rem;
        -webkit-line-clamp: 2;
    }
}

/* Trending Pagination Dots */
.trending-dots {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 1rem;
    padding: 0.5rem;
}

.trending-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.trending-dot:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.2);
}

.trending-dot.active {
    background: #1877f2;
    width: 12px;
    height: 12px;
}

@media (max-width: 768px) {
    .trending-dots {
        margin-top: 0.75rem;
    }
    
    .trending-dot {
        width: 8px;
        height: 8px;
    }
    
    .trending-dot.active {
        width: 10px;
        height: 10px;
    }
}

/* ========================================
   SUPPORT CONTAINER SECTION
   ======================================== */
.support-section {
    max-width: 1400px;
    margin: 0 auto 2rem;
    padding: 0;
}

.support-container {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: clamp(1rem, 2vw, 1.5rem);
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: clamp(1rem, 2vw, 1.5rem);
}

.support-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: clamp(8px, 1.5vw, 12px);
    padding: clamp(14px, 2vw, 18px) clamp(20px, 3vw, 32px);
    border-radius: clamp(10px, 1.5vw, 14px);
    text-decoration: none;
    font-weight: 700;
    font-size: clamp(14px, 1.8vw, 18px);
    color: #fff;
    transition: all 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    flex: 1;
}

.support-button-github {
    background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%);
}

.support-button-github:hover {
    background: linear-gradient(135deg, #2f363d 0%, #24292e 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(36, 41, 46, 0.4);
}

.support-button-facebook {
    background: linear-gradient(135deg, #1877f2 0%, #0d5fcc 100%);
}

.support-button-facebook:hover {
    background: linear-gradient(135deg, #2984f6 0%, #1877f2 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(24, 119, 242, 0.4);
}

.support-button-trakteer {
    background: linear-gradient(135deg, #be1e2d 0%, #d32f2f 100%);
}

.support-button-trakteer:hover {
    background: linear-gradient(135deg, #d32f2f 0%, #be1e2d 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(190, 30, 45, 0.4);
}

.support-icon {
    width: clamp(20px, 2.5vw, 28px);
    height: clamp(20px, 2.5vw, 28px);
    flex-shrink: 0;
}

.support-text {
    white-space: nowrap;
    line-height: 1;
}

.support-text-mobile {
    display: none;
}

/* Tablet Support Container */
@media (min-width: 768px) and (max-width: 1023px) {
    .support-container {
        grid-template-columns: 1fr 1fr 1fr;
    }
    
    .support-button {
        font-size: 14px;
    }
    
    /* Hide "Donasi Chapter", show "Donasi" on tablet */
    .support-button-trakteer .support-text-desktop {
        display: none;
    }
    
    .support-button-trakteer .support-text-mobile {
        display: inline;
    }
}

/* Mobile Support Container */
@media (max-width: 767px) {
    .support-section {
        margin-bottom: 2rem;
    }
    
    .support-container {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 0.875rem;
    }
    
    /* Hide all text on mobile - icon only */
    .support-text,
    .support-text-desktop,
    .support-text-mobile {
        display: none;
    }
    
    .support-button {
        padding: 12px 16px;
        font-size: 13px;
    }
    
    .support-icon {
        width: 20px;
        height: 20px;
    }
}

@media (max-width: 480px) {
    .support-container {
        grid-template-columns: 1fr 1fr 1fr;
    }
    
    .support-button {
        padding: 11px 14px;
        font-size: 12px;
        border-radius: 8px;
    }
    
    .support-icon {
        width: 18px;
        height: 18px;
    }
    
    .support-text {
        font-size: 12px;
    }
}

@media (max-width: 399px) {
    .support-container {
        padding: 0.75rem;
        gap: 0.75rem;
        grid-template-columns: 1fr 1fr 1fr;
    }
    
    .support-button {
        padding: 10px 10px;
        font-size: 10px;
        gap: 5px;
    }
    
    .support-icon {
        width: 16px;
        height: 16px;
    }
    
    .support-text {
        font-size: 10px;
    }
}

/* Notification Tabs Styling */
.notification-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

.notification-tab {
    flex: 1;
    padding: 12px 16px;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    border-bottom: 2px solid transparent;
}

.notification-tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.9);
}

.notification-tab.active {
    color: #1877f2;
    border-bottom-color: #1877f2;
    background: rgba(24, 119, 242, 0.1);
}

.notification-tab svg {
    stroke: currentColor;
}

/* Notification Content Areas */
.notification-content {
    display: none;
}

.notification-content.active {
    display: block;
}

/* Update Item Styling */
.update-item {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: background 0.2s ease;
}

.update-item:last-child {
    border-bottom: none;
}

.update-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.update-item-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

.update-item-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.update-item-icon.success {
    stroke: #10b981;
}

.update-item-icon.info {
    stroke: #3b82f6;
}

.update-item-icon.warning {
    stroke: #f59e0b;
}

.update-item-title {
    font-size: 14px;
    font-weight: 600;
    color: #fff;
}

.update-item-description {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    padding-left: 28px;
}

.update-item-time {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.5);
    margin-top: 4px;
    padding-left: 28px;
}

/* Empty State for Updates and Comments */
.notification-empty {
    padding: 32px 16px;
    text-align: center;
    color: rgba(255, 255, 255, 0.5);
}

.notification-empty svg {
    width: 48px;
    height: 48px;
    stroke: rgba(255, 255, 255, 0.3);
    margin-bottom: 12px;
}

.notification-empty p {
    font-size: 14px;
    margin: 0;
}

/* ============================================
   EDIT PROFILE MODAL STYLES
   ============================================ */
.profile-username-container {
    position: relative;
    display: inline-block;
    margin: 0 0 12px 0;
}

.profile-username {
    margin: 0 !important;
    line-height: 1.2;
}

.btn-edit-profile {
    position: absolute;
    right: -35px;
    top: 0;
    bottom: 0;
    margin: auto 0;
    height: 24px;
    background: transparent;
    border: none;
    padding: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.8;
}

.btn-edit-profile:hover {
    opacity: 1;
    transform: scale(1.15);
}

.btn-edit-profile svg {
    stroke: #ffd700;
    filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.8))
            drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))
            drop-shadow(0 0 12px rgba(255, 215, 0, 0.4));
    animation: pencilGlow 2s ease-in-out infinite;
}

.btn-edit-profile:hover svg {
    filter: drop-shadow(0 0 6px rgba(255, 215, 0, 1))
            drop-shadow(0 0 12px rgba(255, 215, 0, 0.8))
            drop-shadow(0 0 18px rgba(255, 215, 0, 0.6));
}

@keyframes pencilGlow {
    0%, 100% {
        filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.8))
                drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))
                drop-shadow(0 0 12px rgba(255, 215, 0, 0.4));
    }
    50% {
        filter: drop-shadow(0 0 6px rgba(255, 215, 0, 1))
                drop-shadow(0 0 10px rgba(255, 215, 0, 0.7))
                drop-shadow(0 0 14px rgba(255, 215, 0, 0.5));
    }
}

/* Hide pencil when rate limited */
.btn-edit-profile.hidden {
    display: none;
}

/* Responsive adjustments for pencil button */
@media (max-width: 767px) {
    .btn-edit-profile {
        right: -30px;
    }
    
    .btn-edit-profile svg {
        width: 14px;
        height: 14px;
    }
}

@media (max-width: 480px) {
    .btn-edit-profile {
        right: -28px;
    }
    
    .btn-edit-profile svg {
        width: 13px;
        height: 13px;
    }
}

/* Edit Profile Modal Content */
.edit-profile-content {
    padding: 32px 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.edit-profile-title {
    font-size: 22px;
    font-weight: 700;
    color: #fff;
    margin: 0 0 8px 0;
    text-align: center;
}

/* Avatar Upload Area */
.avatar-upload-container {
    position: relative;
    width: 100px;
    height: 100px;
}

.avatar-upload-preview {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 3px solid #1877f2;
    object-fit: cover;
    cursor: pointer;
    transition: all 0.3s ease;
}

.avatar-upload-preview:hover {
    opacity: 0.8;
    border-color: #2984f6;
}

.avatar-upload-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
    pointer-events: none;
}

.avatar-upload-container:hover .avatar-upload-overlay {
    opacity: 1;
    pointer-events: auto;
}

.avatar-upload-overlay svg {
    stroke: #fff;
}

#avatarInput {
    display: none;
}

/* Display Name Input */
.edit-form-group {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.edit-form-group label {
    font-size: 14px;
    font-weight: 600;
    color: #b0b0b0;
}

.edit-form-group input {
    width: 100%;
    padding: 14px 16px;
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    background: #1a1a1a;
    color: #fff;
    font-size: 16px;
    outline: none;
    transition: all 0.3s ease;
}

.edit-form-group input:focus {
    border-color: #1877f2;
    background: #222;
}

.edit-form-group input::placeholder {
    color: #666;
}

/* Warning Box */
.edit-warning-box {
    background: rgba(251, 191, 36, 0.1);
    border: 1px solid rgba(251, 191, 36, 0.3);
    border-radius: 12px;
    padding: 14px 16px;
    width: 100%;
}

.edit-warning-text {
    font-size: 13px;
    color: #fbbf24;
    line-height: 1.5;
}

/* Buttons */
.edit-profile-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.btn-save-profile {
    background: linear-gradient(135deg, #1877f2 0%, #0d5fcc 100%);
    color: #fff;
    border: none;
    padding: 16px 24px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn-save-profile:hover:not(:disabled) {
    background: linear-gradient(135deg, #2984f6 0%, #1877f2 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(24, 119, 242, 0.4);
}

.btn-save-profile:disabled {
    background: #424242;
    color: #888;
    cursor: not-allowed;
    opacity: 0.6;
}

.btn-cancel-edit {
    background: transparent;
    color: #bbb;
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 14px 24px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

.btn-cancel-edit:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.3);
    color: #fff;
    transform: translateY(-1px);
}

/* Loading State */
.btn-save-profile.loading {
    pointer-events: none;
    opacity: 0.7;
}

.btn-save-profile.loading::after {
    content: '';
    width: 16px;
    height: 16px;
    border: 2px solid #fff;
    border-top-color: transparent;
    border-radius: 50%;
    display: inline-block;
    margin-left: 10px;
    animation: spin 0.6s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Error Message */
.edit-error-message {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    padding: 12px;
    color: #ef4444;
    font-size: 13px;
    text-align: center;
    width: 100%;
    display: none;
}

.edit-error-message.show {
    display: block;
}

/* Success Message */
.edit-success-message {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 8px;
    padding: 12px;
    color: #10b981;
    font-size: 13px;
    text-align: center;
    width: 100%;
    display: none;
}

.edit-success-message.show {
    display: block;
}

/* Responsive */
@media (max-width: 480px) {
    .edit-profile-content {
        padding: 24px 20px;
        gap: 16px;
    }

    .edit-profile-title {
        font-size: 19px;
    }

    .avatar-upload-container {
        width: 85px;
        height: 85px;
    }

    .edit-form-group input {
        padding: 12px 14px;
        font-size: 15px;
    }

    .btn-save-profile {
        padding: 14px 20px;
        font-size: 15px;
    }

    .btn-cancel-edit {
        padding: 12px 20px;
        font-size: 14px;
    }
}
        </style>
    </head>
    <body>
        <!-- ✅ Skip to main content link -->
        <a href="#main-content" class="skip-link">Skip to main content</a>

        <header role="banner">
            <div class="header-content">
                <a
                    href="https://www.nuranantoscans.my.id"
                    class="logo-link"
                    aria-label="Nurananto Scanlation Home"
                >
                    <img
                        src="assets/logo.png"
                        alt="Nurananto Scanlation Logo"
                        class="site-logo"
                        width="200"
                        height="60"
                    />
                </a>

                <nav aria-label="Social media links">
                    <!-- Desktop: Show all buttons -->
                    <div class="header-buttons">
  <!-- Profile/Login Button -->
  <button class="header-icon-button profile-button" 
          id="btnOpenLogin"
          aria-label="Login or Register">
    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
      <circle cx="12" cy="7" r="4"/>
    </svg>
    <span class="button-text">Login</span>
  </button>
  
  <!-- Notification Button -->
  <div class="notification-wrapper">
    <button class="header-icon-button notification-button" 
            id="btnNotification"
            aria-label="View notifications">
      <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
      <span class="notification-badge" id="notificationBadge" style="display: none;"></span>
    </button>
    
    <!-- Notification Dropdown -->
    <div class="notification-dropdown" id="notificationDropdown" style="display: none;">
      <div class="notification-header">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          Notifikasi
        </h3>
        <button id="btnSyncNotifications" class="btn-sync-notif" title="Sync komentar / Refresh update">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
          </svg>
        </button>
      </div>
      
      <!-- Notification Tabs -->
      <div class="notification-tabs">
        <button class="notification-tab active" data-tab="comments">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          Komentar
        </button>
        <button class="notification-tab" data-tab="updates">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Update
        </button>
      </div>
      
      <!-- Comments Content -->
      <div class="notification-content active" id="notificationComments">
        <!-- Comments will be dynamically loaded -->
      </div>
      
      <!-- Updates Content -->
      <div class="notification-content" id="notificationUpdates" style="display: none;">
        <!-- Updates will be dynamically loaded -->
      </div>
    </div>
  </div>
</div>

                    <!-- Mobile: Show Login Button Only (No Hamburger) -->
                </nav>
            </div>
            <div class="header-border"></div>
        </header>

        <!-- Ganti bagian <main> di index.html dengan ini -->

        <main role="main" id="main-content">
            <!-- TRENDING SECTION -->
            <section class="trending-section" aria-labelledby="trending-heading">
                <h2 id="trending-heading" class="visually-hidden">Trending Manga</h2>
                <div class="trending-container" id="trendingContainer">
                    <!-- Trending content will be added here -->
                </div>
                <!-- Trending Pagination Dots -->
                <div class="trending-dots" id="trendingDots"></div>
            </section>

            <!-- SUPPORT CONTAINER SECTION -->
            <section class="support-section" aria-labelledby="support-heading">
                <h2 id="support-heading" class="visually-hidden">Support Links</h2>
                <div class="support-container">
                    <a href="https://github.com/nurananto/nuranantoscans" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="support-button support-button-github"
                       aria-label="View source code on GitHub (opens in new tab)">
                        <svg class="support-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        <span class="support-text support-text-desktop">Source</span>
                    </a>
                    
                    <a href="https://web.facebook.com/profile.php?id=61556658895013" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="support-button support-button-facebook"
                       aria-label="Follow Nurananto Scans on Facebook (opens in new tab)">
                        <svg class="support-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        <span class="support-text support-text-desktop">Facebook</span>
                    </a>
                    
                    <a href="https://trakteer.id/NuranantoScanlation" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="support-button support-button-trakteer"
                       aria-label="Donate to buy RAW chapters on Trakteer (opens in new tab)">
                        <svg class="support-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v12M9 9h6M9 15h6"/>
                        </svg>
                        <span class="support-text support-text-desktop">Donasi Chapter</span>
                        <span class="support-text support-text-mobile">Donasi</span>
                    </a>
                </div>
            </section>

            <!-- MANGA LIST SECTION WITH SEARCH -->
            <section
                class="manga-list-section"
                aria-labelledby="manga-list-heading"
            >
                <!-- Header and Search outside container -->
                <div class="manga-list-header">
                    <h2 id="manga-list-heading" class="manga-list-heading">
                        Manga List
                    </h2>
                    <label for="searchInput" class="visually-hidden"
                        >Search manga by title</label
                    >
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Cari..."
                        aria-label="Search manga by title"
                        autocomplete="off"
                    />
                </div>

                <!-- Loading indicator -->
                <div
                    id="loadingIndicator"
                    class="loading-indicator"
                    role="status"
                    aria-live="polite"
                >
                    <div class="spinner" aria-hidden="true"></div>
                    <p>Memuat daftar manga...</p>
                </div>

                <!-- Manga List Container -->
                <div class="manga-list-container" id="mangaGrid" role="list">
                    <!-- Manga cards will be rendered here by JavaScript -->
                </div>

                <!-- Pagination Controls -->
                <div class="pagination-container" id="paginationControls" style="display: none;">
                    <button id="prevPageBtn" class="pagination-btn pagination-btn-prev" aria-label="Previous page">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                        <span>Previous</span>
                    </button>
                    <span id="pageIndicator" class="page-indicator">Page 1 of 1</span>
                    <button id="nextPageBtn" class="pagination-btn pagination-btn-next" aria-label="Next page">
                        <span>Next</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </div>
            </section>
        </main>

        <!-- ✅ FOOTER with proper landmark -->
        <footer role="contentinfo" class="main-footer">
            <div class="footer-content">
                <div class="footer-disclaimer">
                    <h3 class="footer-title">Disclaimer</h3>
                    <p class="footer-text">
                        Semua bacaan yang ada di website ini merupakan hasil terjemahan fans <strong>Nurananto Scanlation</strong> bukan terjemahan resmi. 
                        Jangan lupa untuk memberikan dukungan langsung kepada author dengan membeli karya-karya asli mereka melalui link raw yang sudah disediakan.
                    </p>
                    <h3 class="footer-title">Support Author</h3>
                    <p class="footer-text">
                        Beli karya asli untuk mendukung author dan industri manga/komik yang Anda sukai!
                    </p>
                </div>
            </div>
        </footer>

        <!-- ✅ Scripts -->
        <script defer src="common.js?v=20260220e"></script>
        <script defer src="manga-config.js?v=20260220e"></script>
        <script defer src="script.js?v=20260220e"></script>
        <script defer src="auto-reload.js?v=20260220e"></script>

        <!-- Browser Image Compression Library - Load with error handling -->
        <script>
        (function() {
            // console.log('📦 [CDN-LOADER] Starting to load browser-image-compression...');
            
            // Use jsDelivr as primary CDN (most reliable, no SRI issues)
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js';
            script.async = false; // Synchronous loading
            script.crossOrigin = 'anonymous';
            
            script.onload = function() {
                // console.log('✅ [CDN-LOADER] browser-image-compression loaded successfully from jsDelivr!');
                // console.log('   - typeof imageCompression:', typeof imageCompression);
                // console.log('   - window.imageCompression:', !!window.imageCompression);
            };
            
            script.onerror = function() {
                console.error('❌ [CDN-LOADER] Failed to load from jsDelivr, trying unpkg fallback...');
                
                // Try fallback CDN #1: unpkg
                const fallbackScript1 = document.createElement('script');
                fallbackScript1.src = 'https://unpkg.com/browser-image-compression@2.0.2/dist/browser-image-compression.js';
                fallbackScript1.async = false;
                
                fallbackScript1.onload = function() {
                    // console.log('✅ [CDN-LOADER] browser-image-compression loaded from unpkg fallback!');
                    // console.log('   - typeof imageCompression:', typeof imageCompression);
                };
                
                fallbackScript1.onerror = function() {
                    console.error('❌ [CDN-LOADER] unpkg failed, trying cdnjs fallback...');
                    
                    // Try fallback CDN #2: cdnjs (last resort, no SRI check)
                    const fallbackScript2 = document.createElement('script');
                    fallbackScript2.src = 'https://cdnjs.cloudflare.com/ajax/libs/browser-image-compression/2.0.2/browser-image-compression.min.js';
                    fallbackScript2.async = false;
                    
                    fallbackScript2.onload = function() {
                        // console.log('✅ [CDN-LOADER] browser-image-compression loaded from cdnjs fallback!');
                        // console.log('   - typeof imageCompression:', typeof imageCompression);
                    };
                    
                    fallbackScript2.onerror = function() {
                        console.error('❌ [CDN-LOADER] All 3 CDN sources failed!');
                        console.error('❌ [CDN-LOADER] Avatar compression will not work.');
                        console.error('💡 [CDN-LOADER] Please check your internet connection or try disabling ad blocker.');
                    };
                    
                    document.head.appendChild(fallbackScript2);
                };
                
                document.head.appendChild(fallbackScript1);
            };
            
            document.head.appendChild(script);
            // console.log('🔄 [CDN-LOADER] Script tag added to head, waiting for load...');
        })();
        </script>

        <!-- Edit Profile Handler -->
        <script>
        // Edit Profile functionality - Global initialization function
        // This is called every time profile modal is cloned/opened
        window.initEditProfile = function() {
            const DEBUG = false; // Set to 'true' to enable debug logs
            // console.log('🎨 [EDIT-PROFILE] ========================================');
            // console.log('🎨 [EDIT-PROFILE] Initializing edit profile module...');
            
            const editProfileModal = document.getElementById('editProfileModal');
            const profileModal = document.getElementById('profileModal');
            const btnEditProfile = document.getElementById('btnEditProfile');
            const btnCancelEdit = document.getElementById('btnCancelEdit');
            const btnSaveProfile = document.getElementById('btnSaveProfile');
            const avatarInput = document.getElementById('avatarInput');
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarUploadOverlay = document.getElementById('avatarUploadOverlay');
            const displayNameInput = document.getElementById('displayNameInput');
            const editErrorMessage = document.getElementById('editErrorMessage');
            const editSuccessMessage = document.getElementById('editSuccessMessage');

            // console.log('🔍 [EDIT-PROFILE] DOM Elements check:');
            // console.log('   - editProfileModal:', !!editProfileModal);
            // console.log('   - profileModal:', !!profileModal);
            // console.log('   - btnEditProfile:', !!btnEditProfile);
            // console.log('   - btnCancelEdit:', !!btnCancelEdit);
            // console.log('   - btnSaveProfile:', !!btnSaveProfile);
            // console.log('   - avatarInput:', !!avatarInput);
            // console.log('   - avatarPreview:', !!avatarPreview);
            // console.log('   - avatarUploadOverlay:', !!avatarUploadOverlay);
            // console.log('   - displayNameInput:', !!displayNameInput);
            // console.log('   - editErrorMessage:', !!editErrorMessage);
            // console.log('   - editSuccessMessage:', !!editSuccessMessage);

            let selectedAvatarFile = null;
            let hasChanges = false;
            const PROFILE_WORKER_URL = 'https://profile-worker.nuranantoadhien.workers.dev';
            
            // console.log('⚙️ [EDIT-PROFILE] Worker URL:', PROFILE_WORKER_URL);
            // console.log('🎨 [EDIT-PROFILE] ========================================');

            // Open edit profile modal
            if (btnEditProfile) {
                btnEditProfile.addEventListener('click', function() {
                    // console.log('✏️ [EDIT] ========================================');
                    // console.log('✏️ [EDIT] Edit profile button clicked!');
                    
                    // Load current data
                    const currentUsername = document.getElementById('profileUsername')?.textContent || '';
                    const currentAvatar = document.querySelector('.profile-avatar')?.src || 'assets/Logo 2.png';
                    
                    // console.log('📋 [EDIT] Current data:');
                    // console.log('   - Username:', currentUsername);
                    // console.log('   - Avatar URL:', currentAvatar);
                    
                    displayNameInput.value = currentUsername;
                    avatarPreview.src = currentAvatar;
                    
                    selectedAvatarFile = null;
                    hasChanges = false;
                    btnSaveProfile.disabled = true;
                    
                    // console.log('🔄 [EDIT] Reset state:');
                    // console.log('   - selectedAvatarFile:', selectedAvatarFile);
                    // console.log('   - hasChanges:', hasChanges);
                    // console.log('   - btnSaveProfile.disabled:', btnSaveProfile.disabled);
                    
                    // Hide messages
                    editErrorMessage.classList.remove('show');
                    editSuccessMessage.classList.remove('show');
                    
                    profileModal.style.display = 'none';
                    editProfileModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                    
                    // console.log('✅ [EDIT] Edit profile modal opened!');
                    // console.log('✏️ [EDIT] ========================================');
                });
                // console.log('✅ [EDIT-PROFILE] Edit button listener added');
            }

            // Close edit modal
            if (btnCancelEdit) {
                btnCancelEdit.addEventListener('click', function() {
                    // console.log('❌ [CANCEL] ========================================');
                    // console.log('❌ [CANCEL] Cancel button clicked!');
                    // console.log('❌ [CANCEL] Closing edit modal...');
                    
                    editProfileModal.style.display = 'none';
                    profileModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                    
                    // console.log('✅ [CANCEL] Edit modal closed, profile modal shown');
                    // console.log('❌ [CANCEL] ========================================');
                });
                // console.log('✅ [EDIT-PROFILE] Cancel button listener added');
            }

            // Close on overlay click - DISABLED (only cancel button closes modal)
            // if (editProfileModal) {
            //     editProfileModal.addEventListener('click', function(e) {
            //         if (e.target === editProfileModal) {
            //             console.log('🖱️ [OVERLAY] ========================================');
            //             console.log('🖱️ [OVERLAY] Edit modal overlay clicked!');
            //             console.log('🖱️ [OVERLAY] Closing edit modal...');
            //             
            //             editProfileModal.style.display = 'none';
            //             profileModal.style.display = 'flex';
            //             document.body.style.overflow = 'hidden';
            //             
            //             console.log('✅ [OVERLAY] Edit modal closed via overlay');
            //             console.log('🖱️ [OVERLAY] ========================================');
            //         }
            //     });
            //     console.log('✅ [EDIT-PROFILE] Overlay click listener added');
            // }

            // Avatar upload handler
            if (avatarUploadOverlay && avatarPreview && avatarInput) {
                if (DEBUG) console.log('🔧 [AVATAR-SETUP] Setting up avatar upload handlers...');
                if (DEBUG) console.log('   - avatarUploadOverlay:', !!avatarUploadOverlay);
                if (DEBUG) console.log('   - avatarPreview:', !!avatarPreview);
                if (DEBUG) console.log('   - avatarInput:', !!avatarInput);
                if (DEBUG) console.log('   - avatarInput.type:', avatarInput.type);
                if (DEBUG) console.log('   - avatarInput.id:', avatarInput.id);
                
                avatarUploadOverlay.addEventListener('click', function() {
                    if (DEBUG) console.log('🖼️ [AVATAR] Avatar overlay clicked - opening file picker...');
                    avatarInput.click();
                });

                avatarPreview.addEventListener('click', function() {
                    if (DEBUG) console.log('🖼️ [AVATAR] Avatar preview clicked - opening file picker...');
                    avatarInput.click();
                });

                avatarInput.addEventListener('change', async function(e) {
                    if (DEBUG) console.log('📁 [AVATAR] ========================================');
                    if (DEBUG) console.log('📁 [AVATAR] *** FILE INPUT CHANGE EVENT FIRED! ***');
                    if (DEBUG) console.log('📁 [AVATAR] Event:', e);
                    if (DEBUG) console.log('📁 [AVATAR] e.target:', e.target);
                    if (DEBUG) console.log('📁 [AVATAR] e.target.files:', e.target.files);
                    if (DEBUG) console.log('📁 [AVATAR] e.target.files.length:', e.target.files?.length);
                    
                    const file = e.target.files[0];
                    if (DEBUG) console.log('📁 [AVATAR] file:', file);
                    
                    if (!file) {
                        if (DEBUG) console.log('⚠️ [AVATAR] No file selected');
                        if (DEBUG) console.log('📁 [AVATAR] ========================================');
                        return;
                    }

                    if (DEBUG) console.log('📂 [AVATAR] File selected:');
                    if (DEBUG) console.log('   - Name:', file.name);
                    if (DEBUG) console.log('   - Type:', file.type);
                    if (DEBUG) console.log('   - Size:', (file.size / 1024).toFixed(2), 'KB');

                    // Validate file type
                    const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];
                    if (!allowedTypes.includes(file.type)) {
                        console.error('❌ [AVATAR] Invalid file type:', file.type);
                        showError('Format file harus JPEG, PNG, atau WebP');
                        if (DEBUG) console.log('📁 [AVATAR] ========================================');
                        return;
                    }
                    
                    if (DEBUG) console.log('✅ [AVATAR] File type valid');

                    try {
                        if (DEBUG) console.log('🔄 [AVATAR] Starting compression...');
                        
                        // Check if imageCompression library is loaded
                        if (typeof imageCompression === 'undefined') {
                            console.error('❌ [AVATAR] imageCompression library not loaded!');
                            showError('Library kompresi gambar belum siap. Silakan refresh halaman dan coba lagi.');
                            if (DEBUG) console.log('📁 [AVATAR] ========================================');
                            return;
                        }
                        
                        if (DEBUG) console.log('✅ [AVATAR] imageCompression library available');
                        
                        // Compress image (disable web worker to avoid CSP issues)
                        const options = {
                            maxSizeMB: 0.5, // Target 500KB (more realistic)
                            maxWidthOrHeight: 1024, // Allow slightly larger for better quality
                            useWebWorker: false, // Disable to avoid CSP blob: restriction
                            fileType: file.type,
                            initialQuality: 0.8 // Start with 80% quality
                        };

                        const compressedFile = await imageCompression(file, options);
                        
                        if (DEBUG) console.log('✅ [AVATAR] Compression complete:');
                        if (DEBUG) console.log('   - Original size:', (file.size / 1024).toFixed(2), 'KB');
                        if (DEBUG) console.log('   - Compressed size:', (compressedFile.size / 1024).toFixed(2), 'KB');
                        if (DEBUG) console.log('   - Reduction:', ((1 - compressedFile.size / file.size) * 100).toFixed(1), '%');
                        
                        // Smart file selection: use original if compression made it bigger
                        let finalFile;
                        if (compressedFile.size >= file.size) {
                            if (DEBUG) console.log('⚠️ [AVATAR] Compressed file is larger than original, using original instead');
                            finalFile = file;
                        } else {
                            if (DEBUG) console.log('✅ [AVATAR] Using compressed file (smaller)');
                            finalFile = compressedFile;
                        }
                        
                        if (DEBUG) console.log('📊 [AVATAR] Final file stats:');
                        if (DEBUG) console.log('   - Final size:', (finalFile.size / 1024).toFixed(2), 'KB');
                        
                        // Check final size
                        if (finalFile.size > 1024 * 1024) {
                            console.error('❌ [AVATAR] File too large:', (finalFile.size / 1024).toFixed(2), 'KB');
                            showError('Ukuran file maksimal 1 MB');
                            if (DEBUG) console.log('📁 [AVATAR] ========================================');
                            return;
                        }

                        selectedAvatarFile = finalFile;
                        if (DEBUG) console.log('💾 [AVATAR] File stored in memory');
                        
                        // Preview
                        if (DEBUG) console.log('🖼️ [AVATAR] Updating preview...');
                        if (DEBUG) console.log('   - avatarPreview element:', avatarPreview);
                        if (DEBUG) console.log('   - avatarPreview.src (before):', avatarPreview.src);
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            if (DEBUG) console.log('📸 [AVATAR] FileReader onload fired');
                            if (DEBUG) console.log('   - Result length:', e.target.result.length);
                            avatarPreview.src = e.target.result;
                            if (DEBUG) console.log('   - avatarPreview.src (after):', avatarPreview.src.substring(0, 50) + '...');
                            if (DEBUG) console.log('✅ [AVATAR] Preview updated successfully!');
                        };
                        reader.onerror = function(e) {
                            console.error('❌ [AVATAR] FileReader error:', e);
                        };
                        reader.readAsDataURL(finalFile);
                        if (DEBUG) console.log('🔄 [AVATAR] FileReader started reading...');

                        hasChanges = true;
                        checkChanges();
                        
                        if (DEBUG) console.log('✅ [AVATAR] Avatar upload complete!');
                        if (DEBUG) console.log('   - hasChanges:', hasChanges);
                        if (DEBUG) console.log('📁 [AVATAR] ========================================');
                    } catch (error) {
                        console.error('❌ [AVATAR] Compression error:', error);
                        showError('Gagal memproses gambar');
                        if (DEBUG) console.log('📁 [AVATAR] ========================================');
                    }
                });
                // console.log('✅ [EDIT-PROFILE] Avatar upload listeners added');
            }

            // Display name change handler
            if (displayNameInput) {
                displayNameInput.addEventListener('input', function() {
                    if (DEBUG) console.log('⌨️ [NAME] Display name input changed:', this.value);
                    
                    const currentUsername = document.getElementById('profileUsername')?.textContent || '';
                    hasChanges = this.value.trim() !== currentUsername || selectedAvatarFile !== null;
                    
                    if (DEBUG) console.log('🔄 [NAME] hasChanges:', hasChanges);
                    if (DEBUG) console.log('   - Current:', currentUsername);
                    if (DEBUG) console.log('   - New:', this.value.trim());
                    if (DEBUG) console.log('   - Has avatar:', selectedAvatarFile !== null);
                    
                    checkChanges();
                });
                // console.log('✅ [EDIT-PROFILE] Display name input listener added');
            }

            // Check if there are changes
            function checkChanges() {
                const isValid = displayNameInput.value.trim().length >= 3 && 
                               displayNameInput.value.trim().length <= 30;
                const wasDisabled = btnSaveProfile.disabled;
                btnSaveProfile.disabled = !hasChanges || !isValid;
                
                if (wasDisabled !== btnSaveProfile.disabled) {
                    if (DEBUG) console.log('🔘 [CHECK] Save button state changed:');
                    if (DEBUG) console.log('   - Disabled:', btnSaveProfile.disabled);
                    if (DEBUG) console.log('   - hasChanges:', hasChanges);
                    if (DEBUG) console.log('   - isValid:', isValid);
                    if (DEBUG) console.log('   - Name length:', displayNameInput.value.trim().length);
                }
            }

            // Show error message
            function showError(message) {
                console.error('❌ [ERROR] Showing error:', message);
                editErrorMessage.textContent = message;
                editErrorMessage.classList.add('show');
                editSuccessMessage.classList.remove('show');
                setTimeout(() => {
                    editErrorMessage.classList.remove('show');
                    if (DEBUG) console.log('🔄 [ERROR] Error message auto-hidden');
                }, 5000);
            }

            // Show success message
            function showSuccess(message) {
                if (DEBUG) console.log('✅ [SUCCESS] Showing success:', message);
                editSuccessMessage.textContent = message;
                editSuccessMessage.classList.add('show');
                editErrorMessage.classList.remove('show');
            }

            // Save profile
            if (btnSaveProfile) {
                btnSaveProfile.addEventListener('click', async function() {
                    if (DEBUG) console.log('💾 [SAVE] ========================================');
                    if (DEBUG) console.log('💾 [SAVE] Save profile button clicked!');
                    
                    if (this.disabled || this.classList.contains('loading')) {
                        if (DEBUG) console.log('⚠️ [SAVE] Button disabled or loading - ignoring click');
                        if (DEBUG) console.log('💾 [SAVE] ========================================');
                        return;
                    }

                    this.classList.add('loading');
                    this.textContent = 'MENYIMPAN';
                    editErrorMessage.classList.remove('show');
                    editSuccessMessage.classList.remove('show');
                    
                    if (DEBUG) console.log('🔄 [SAVE] Button set to loading state');

                    // Use getAuthToken() from common.js (checks expiry too)
                    const token = getAuthToken();
                    if (!token) {
                        console.error('❌ [SAVE] No token found!');
                        showError('Anda harus login terlebih dahulu');
                        this.classList.remove('loading');
                        this.textContent = 'SIMPAN';
                        if (DEBUG) console.log('💾 [SAVE] ========================================');
                        return;
                    }
                    
                    if (DEBUG) console.log('✅ [SAVE] Token found:', token.substring(0, 20) + '...');

                    try {
                        let success = false;

                        // Upload avatar if changed
                        if (selectedAvatarFile) {
                            if (DEBUG) console.log('📤 [SAVE] Uploading avatar...');
                            if (DEBUG) console.log('   - File size:', (selectedAvatarFile.size / 1024).toFixed(2), 'KB');
                            if (DEBUG) console.log('   - File type:', selectedAvatarFile.type);
                            
                            const formData = new FormData();
                            formData.append('avatar', selectedAvatarFile);

                            const avatarResponse = await fetch(`${PROFILE_WORKER_URL}/profile/upload-avatar`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${token}`
                                },
                                body: formData
                            });

                            if (DEBUG) console.log('📥 [SAVE] Avatar upload response status:', avatarResponse.status);
                            const avatarData = await avatarResponse.json();
                            if (DEBUG) console.log('📦 [SAVE] Avatar response data:', avatarData);

                            if (avatarData.success) {
                                success = true;
                                if (DEBUG) console.log('✅ [SAVE] Avatar uploaded successfully!');
                                if (DEBUG) console.log('   - New avatar URL:', avatarData.avatarUrl);
                                
                                // Update profile avatar
                                const profileAvatar = document.querySelector('.profile-avatar');
                                if (profileAvatar) {
                                    profileAvatar.src = avatarData.avatarUrl;
                                    if (DEBUG) console.log('🖼️ [SAVE] Profile avatar UI updated');
                                }
                            } else {
                                console.error('❌ [SAVE] Avatar upload failed:', avatarData.error);
                                throw new Error(avatarData.error || 'Upload avatar gagal');
                            }
                        } else {
                            if (DEBUG) console.log('⏭️ [SAVE] No avatar file selected, skipping upload');
                        }

                        // Update display name if changed
                        const currentUsername = document.getElementById('profileUsername')?.textContent || '';
                        const newDisplayName = displayNameInput.value.trim();

                        if (newDisplayName !== currentUsername) {
                            if (DEBUG) console.log('📝 [SAVE] Updating display name...');
                            if (DEBUG) console.log('   - Old name:', currentUsername);
                            if (DEBUG) console.log('   - New name:', newDisplayName);
                            
                            const nameResponse = await fetch(`${PROFILE_WORKER_URL}/profile/update-name`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${token}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ displayName: newDisplayName })
                            });

                            if (DEBUG) console.log('📥 [SAVE] Name update response status:', nameResponse.status);
                            const nameData = await nameResponse.json();
                            if (DEBUG) console.log('📦 [SAVE] Name response data:', nameData);

                            if (nameData.success) {
                                success = true;
                                if (DEBUG) console.log('✅ [SAVE] Display name updated successfully!');
                                
                                // Update profile username
                                const profileUsername = document.getElementById('profileUsername');
                                if (profileUsername) {
                                    profileUsername.textContent = newDisplayName;
                                    if (DEBUG) console.log('📝 [SAVE] Profile username UI updated');
                                }
                            } else {
                                console.error('❌ [SAVE] Name update failed:', nameData.error);
                                throw new Error(nameData.error || 'Update nama gagal');
                            }
                        } else {
                            if (DEBUG) console.log('⏭️ [SAVE] Display name unchanged, skipping update');
                        }

                        // Show success
                        if (success) {
                            if (DEBUG) console.log('🎉 [SAVE] Profile save complete!');
                            showSuccess('✅ Profile berhasil diupdate!');
                            
                            // Re-check eligibility to hide pencil if rate limited
                            if (typeof window.checkEditEligibility === 'function') {
                                window.checkEditEligibility();
                            }
                            
                            setTimeout(() => {
                                if (DEBUG) console.log('🔄 [SAVE] Closing edit modal...');
                                editProfileModal.style.display = 'none';
                                profileModal.style.display = 'flex';
                                selectedAvatarFile = null;
                                hasChanges = false;
                                if (DEBUG) console.log('✅ [SAVE] Modal switched, state reset');
                            }, 2000);
                        } else {
                            if (DEBUG) console.log('⚠️ [SAVE] No changes were made');
                            showError('Tidak ada perubahan untuk disimpan');
                        }

                    } catch (error) {
                        console.error('❌ [SAVE] Save profile error:', error);
                        console.error('❌ [SAVE] Error details:', {
                            message: error.message,
                            stack: error.stack
                        });
                        showError(error.message || 'Gagal menyimpan profile');
                    } finally {
                        this.classList.remove('loading');
                        this.textContent = 'SIMPAN';
                        if (DEBUG) console.log('🔄 [SAVE] Button reset to normal state');
                        if (DEBUG) console.log('💾 [SAVE] ========================================');
                    }
                });
                // console.log('✅ [EDIT-PROFILE] Save button listener added');
            }
            
            // console.log('✅ [EDIT-PROFILE] All listeners initialized successfully!');
        }; // End of initEditProfile function

        // console.log('🚀 [INIT-SCRIPT-LOADED] Edit profile script loaded!');
        // console.log('🚀 [INIT-SCRIPT-LOADED] typeof imageCompression:', typeof imageCompression);
        // console.log('🚀 [INIT-SCRIPT-LOADED] window.initEditProfile:', typeof window.initEditProfile);

        // ============================================
        // LOAD PROFILE DATA FROM DATABASE
        // ============================================
        window.loadProfileData = async function loadProfileData() {
            // console.log('🔄 [PROFILE-LOAD] Loading profile data from database...');
            
            try {
                const token = getAuthToken();
                if (!token) {
                    // console.log('⚠️ [PROFILE-LOAD] No auth token, skipping profile load');
                    return;
                }

                const response = await fetch('https://profile-worker.nuranantoadhien.workers.dev/profile/me', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    console.error('❌ [PROFILE-LOAD] Failed to load profile:', response.status);
                    return;
                }

                const data = await response.json();
                // console.log('📦 [PROFILE-LOAD] Profile data received:', data);

                if (data.success && data.profile) {
                    const { displayName, avatarUrl } = data.profile;
                    // console.log('🔍 [PROFILE-LOAD] Extracted data - displayName:', displayName, 'avatarUrl:', avatarUrl);

                    // Update profile username
                    const profileUsername = document.getElementById('profileUsername');
                    // console.log('🔍 [PROFILE-LOAD] profileUsername element:', profileUsername);
                    
                    if (profileUsername) {
                        if (displayName) {
                            profileUsername.textContent = displayName;
                            // console.log('✅ [PROFILE-LOAD] Username updated to:', displayName);
                            // console.log('🔍 [PROFILE-LOAD] Current username text:', profileUsername.textContent);
                        } // else { console.warn('⚠️ [PROFILE-LOAD] displayName is empty or null'); }
                    } else {
                        console.error('❌ [PROFILE-LOAD] profileUsername element not found!');
                    }

                    // Update profile avatar
                    const profileAvatar = document.querySelector('.profile-avatar');
                    // console.log('🔍 [PROFILE-LOAD] profileAvatar element:', profileAvatar);
                    
                    if (profileAvatar) {
                        if (avatarUrl) {
                            profileAvatar.src = avatarUrl;
                            // console.log('✅ [PROFILE-LOAD] Avatar updated to:', avatarUrl);
                        } // else { console.warn('⚠️ [PROFILE-LOAD] avatarUrl is empty or null'); }
                    } else {
                        console.error('❌ [PROFILE-LOAD] profileAvatar element not found!');
                    }

                    // console.log('🎉 [PROFILE-LOAD] Profile load completed!');
                } // else { console.warn('⚠️ [PROFILE-LOAD] Invalid profile data:', data); }
            } catch (error) {
                console.error('❌ [PROFILE-LOAD] Error loading profile:', error);
            }
        }; // End of loadProfileData

        // ============================================
        // CHECK EDIT ELIGIBILITY & HIDE PENCIL IF RATE LIMITED
        // ============================================
        window.checkEditEligibility = async function() {
            // console.log('🔍 [ELIGIBILITY] Checking edit eligibility...');
            
            try {
                const token = getAuthToken();
                if (!token) {
                    // console.log('⚠️ [ELIGIBILITY] No auth token');
                    return;
                }

                const response = await fetch('https://profile-worker.nuranantoadhien.workers.dev/profile/check-eligibility', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    console.error('❌ [ELIGIBILITY] Failed to check eligibility:', response.status);
                    return;
                }

                const data = await response.json();
                // console.log('📦 [ELIGIBILITY] Response:', data);

                if (data.success) {
                    const btnEditProfile = document.getElementById('btnEditProfile');
                    
                    // Hide pencil if BOTH avatar AND name are rate limited
                    const isRateLimited = !data.avatar.canUpload && !data.name.canChange;
                    
                    if (btnEditProfile) {
                        if (isRateLimited) {
                            btnEditProfile.classList.add('hidden');
                            // console.log('🚫 [ELIGIBILITY] Edit button hidden - rate limited for both avatar and name');
                            // console.log('   - Avatar available in:', data.avatar.remainingDays, 'days');
                            // console.log('   - Name available in:', data.name.remainingDays, 'days');
                        } else {
                            btnEditProfile.classList.remove('hidden');
                            // console.log('✅ [ELIGIBILITY] Edit button visible - editing available');
                        }
                    }
                }
            } catch (error) {
                console.error('❌ [ELIGIBILITY] Error checking eligibility:', error);
            }
        };

        // Load profile data when page loads (if user is logged in)
        // Use window.addEventListener('load') to ensure common.js is loaded first
        window.addEventListener('load', function() {
            // console.log('🔄 [PROFILE-LOAD] Page fully loaded, checking auth status...');
            
            // Check if getAuthToken is available (from common.js)
            if (typeof getAuthToken === 'function') {
                const token = getAuthToken();
                if (token) {
                    // console.log('🔐 [PROFILE-LOAD] User is logged in, loading profile...');
                    window.loadProfileData();
                    window.checkEditEligibility(); // Check if edit button should be hidden
                } // else { console.log('ℹ️ [PROFILE-LOAD] No valid token found, skipping profile load'); }
            } // else { console.warn('⚠️ [PROFILE-LOAD] getAuthToken() not available - common.js might not be loaded'); }
        });
        </script>

        <!-- Service Worker Registration -->
        <script>
            /**
             * ✅ Enhanced Service Worker Registration
             * - Aggressive cache clearing on update
             * - Better error handling
             * - No query string in SW URL
             */
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", async () => {
                    try {
                        // ✅ STEP 1: Unregister old SW with query string
                        const regs =
                            await navigator.serviceWorker.getRegistrations();

                        for (const reg of regs) {
                            // If SW has query string in URL, unregister it
                            if (
                                reg.active &&
                                reg.active.scriptURL.includes("?v=")
                            ) {
                                await reg.unregister();

                                // ✅ Clear all caches after unregistering
                                if ("caches" in window) {
                                    const cacheNames = await caches.keys();
                                    await Promise.all(
                                        cacheNames.map((name) =>
                                            caches.delete(name),
                                        ),
                                    );
                                }
                            }
                        }

                        // ✅ STEP 2: Register new SW (NO query string)
                        const registration =
                            await navigator.serviceWorker.register("./sw.js", {
                                updateViaCache: "none",
                                scope: "./",
                            });

                        // ✅ STEP 3: Check for updates immediately
                        registration.update();

                       // ✅ STEP 4: Listen for updates - SMOOTH TRANSITION
registration.addEventListener("updatefound", () => {
    const newWorker = registration.installing;

    newWorker.addEventListener("statechange", () => {
        if (
            newWorker.state === "installed" &&
            navigator.serviceWorker.controller
        ) {
            // Skip waiting & activate immediately
            newWorker.postMessage({ type: 'SKIP_WAITING' });
        }
    });
});

// ✅ STEP 5: Handle controller change - SMOOTH RELOAD
let refreshing = false;
navigator.serviceWorker.addEventListener(
    "controllerchange",
    () => {
        if (!refreshing) {
            refreshing = true;
            
            // Fade out sebelum reload
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.3s ease';
            
            setTimeout(() => {
                window.location.reload();
            }, 300);
        }
    },
);
                    } catch (err) {
                        // Only show critical errors
                        console.error("❌ SW registration failed:", err);

                        // ✅ If registration fails, try to clear everything and retry once
                        if (err.name !== "SecurityError") {
                            try {
                                // Unregister all
                                const allRegs =
                                    await navigator.serviceWorker.getRegistrations();
                                await Promise.all(
                                    allRegs.map((reg) => reg.unregister()),
                                );

                                // Clear all caches
                                if ("caches" in window) {
                                    const cacheNames = await caches.keys();
                                    await Promise.all(
                                        cacheNames.map((name) =>
                                            caches.delete(name),
                                        ),
                                    );
                                }
                            } catch (cleanupErr) {
                                console.error("❌ Cleanup failed:", cleanupErr);
                            }
                        }
                    }
                });
            }
        </script>

      <!-- ✅ Login Modal -->
<div id="loginModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
  <div class="login-modal-content">
    <!-- ✅ Disclaimer Banner -->
    <div style="background: linear-gradient(135deg, #1877f2 0%, #166fe5 100%); padding: 12px; border-radius: 8px 8px 0 0; text-align: center;">
      <div style="color: white; font-size: 13px; font-weight: 600;">
        🔒 Secure Login - Nurananto Scanlation Web
      </div>
    </div>

    <!-- Tabs -->
    <div class="login-tabs" role="tablist">
      <button class="login-tab active" id="tabLogin" role="tab" aria-selected="true" aria-controls="panelLogin">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3"/>
        </svg>
        Login
      </button>
      <button class="login-tab" id="tabRegister" role="tab" aria-selected="false" aria-controls="panelRegister">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="8.5" cy="7" r="4"/>
          <line x1="20" y1="8" x2="20" y2="14"/>
          <line x1="23" y1="11" x2="17" y2="11"/>
        </svg>
        Register
      </button>
      <button class="login-tab" id="tabForgot" role="tab" aria-selected="false" aria-controls="panelForgot">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        Forgot
      </button>
    </div>

    <!-- Login Panel -->
    <div class="login-panel active" id="panelLogin" role="tabpanel" aria-labelledby="tabLogin">
      <h2 id="login-modal-title" class="login-title">Selamat Datang</h2>
      <form class="login-form" autocomplete="on" action="javascript:void(0)">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <input type="email" 
                 id="loginEmail" 
                 name="email"
                 placeholder="you@example.com" 
                 autocomplete="email" 
                 required>
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <div class="password-input-wrapper">
            <input type="password" 
                   id="loginPassword" 
                   name="password"
                   placeholder="••••••••" 
                   autocomplete="current-password" 
                   required>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
        </div>
        <button type="submit" class="btn-login">Login</button>
        <div class="form-message" id="loginMessage" style="display: none;"></div>
      </form>
    </div>

    <!-- Register Panel -->
    <div class="login-panel" id="panelRegister" role="tabpanel" aria-labelledby="tabRegister">
            <h2 class="login-title">Buat Akun Baru</h2>
      <form class="login-form" autocomplete="on" action="javascript:void(0)">
        <div class="form-group">
          <label for="registerEmail">Email</label>
          <input type="email" 
                 id="registerEmail" 
                 name="email"
                 placeholder="you@example.com" 
                 autocomplete="email" 
                 required>
        </div>
        <div class="form-group">
          <label for="registerPassword">Password</label>
          <div class="password-input-wrapper">
            <input type="password" 
                   id="registerPassword" 
                   name="new-password"
                   placeholder="••••••••" 
                   autocomplete="new-password" 
                   required>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
          <div class="password-strength" id="passwordStrength" style="display: none;">
            <div class="strength-bar">
              <div class="strength-fill" id="strengthFill"></div>
            </div>
            <span class="strength-text" id="strengthText"></span>
            <ul class="strength-hints" id="strengthHints"></ul>
          </div>
        </div>
        <div class="form-group">
          <label for="registerConfirm">Confirm Password</label>
          <div class="password-input-wrapper">
            <input type="password" 
                   id="registerConfirm" 
                   name="confirm-password"
                   placeholder="••••••••" 
                   autocomplete="new-password" 
                   required>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
          <div class="password-match" id="passwordMatch" style="display: none;"></div>
        </div>
        <button type="submit" class="btn-login">Register</button>
        <div class="form-message" id="registerMessage" style="display: none;"></div>
      </form>
    </div>

    <!-- Forgot Password Panel -->
    <div class="login-panel" id="panelForgot" role="tabpanel" aria-labelledby="tabForgot">
      <h2 class="login-title">Ubah Password</h2>
      <p class="login-subtitle">Masukkan email untuk menerima link reset</p>
      <form class="login-form" id="formForgotPassword" autocomplete="on" action="javascript:void(0)">
        <div class="form-group">
          <label for="forgotEmail">Email</label>
          <input type="email" 
                 id="forgotEmail" 
                 name="email"
                 placeholder="you@example.com" 
                 autocomplete="email" 
                 required>
        </div>
        <p id="forgotError" class="code-error"></p>
        <button type="submit" class="btn-login" id="btnSendReset">Kirim Link Reset</button>
        <div class="form-message" id="forgotMessage" style="display: none;"></div>
      </form>
    </div>
  </div>
</div>

<!-- ✅ Profile Modal (TERPISAH - DI LUAR loginModal) -->
<div id="profileModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true">
  <div class="login-modal-content">
    <div class="profile-content">
      <!-- Avatar -->
      <img src="assets/Logo 2.png" alt="Profile Avatar" class="profile-avatar">
      
      <!-- Username with Edit Icon -->
      <div class="profile-username-container">
        <h2 id="profileUsername" class="profile-username">Username</h2>
        <button id="btnEditProfile" class="btn-edit-profile" aria-label="Edit Profile">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        </button>
      </div>
      
      <!-- Status Badge -->
      <div id="statusBadge" class="status-box pembaca-setia">
        <span id="statusText">PEMBACA SETIA</span>
      </div>
      
      <!-- Countdown Timer (only for donatur setia) -->
      <!-- Text akan diupdate oleh JavaScript berdasarkan expiresAt dari API -->
      <div id="countdownBox" class="countdown-box" style="display: none;">
        <span id="countdownText"></span>
      </div>
      
      <!-- Upgrade Button (show for non-donatur) -->
      <button id="btnUpgrade" class="btn-upgrade-profile">
        ⚡ UPGRADE
      </button>
      
      <!-- ✅ History Button -->
      <button id="btnHistory" class="btn-history">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        HISTORY BACA
      </button>
      
      <!-- Logout Button -->
      <button id="btnLogout" class="btn-logout-profile">LOGOUT</button>
    </div>
  </div>
</div>

<!-- ✅ Edit Profile Modal -->
<div id="editProfileModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true">
  <div class="login-modal-content">
    <div class="edit-profile-content">
      <h2 class="edit-profile-title">Edit Profile</h2>

      <!-- Avatar Upload -->
      <div class="avatar-upload-container">
        <img id="avatarPreview" src="assets/Logo 2.png" alt="Avatar Preview" class="avatar-upload-preview">
        <div class="avatar-upload-overlay" id="avatarUploadOverlay">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
        </div>
        <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/webp">
      </div>

      <!-- Display Name Input -->
      <div class="edit-form-group">
        <label for="displayNameInput">Nama Tampilan</label>
        <input 
          type="text" 
          id="displayNameInput" 
          placeholder="Masukkan nama (3-30 karakter)"
          minlength="3"
          maxlength="30"
        >
      </div>

      <!-- Warning -->
      <div class="edit-warning-box">
        <span class="edit-warning-text">
          ⚠️ Ganti foto profile dan nama profile hanya bisa dilakukan <strong>sekali dalam sebulan</strong>.
        </span>
      </div>

      <!-- Error Message -->
      <div id="editErrorMessage" class="edit-error-message"></div>

      <!-- Success Message -->
      <div id="editSuccessMessage" class="edit-success-message"></div>

      <!-- Buttons -->
      <div class="edit-profile-buttons">
        <button id="btnSaveProfile" class="btn-save-profile" disabled>
          SIMPAN
        </button>
        <button id="btnCancelEdit" class="btn-cancel-edit">
          BATAL
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Modal Locked Chapter (untuk user belum login) -->
<div id="loginRequiredModal" class="modal-overlay" style="display: none;">
  <div class="login-modal-content">
    <div class="login-required-content">
      <h2 class="login-required-title">🔒 Chapter Terkunci 🔒</h2>
      <p class="login-required-message login-required-message-primary">
        Chapter Terkunci karena <span class="highlight-text">RAW berbayar</span>.
      </p>
      <p class="login-required-message login-required-message-secondary">
        Locked Chapter bisa dibaca dengan cara
      </p>
      
      <div class="login-required-buttons">
        <button id="btnLoginFromRequired" class="login-required-btn login-required-btn-primary">
          🔐 Login dan Jadilah DONATUR SETIA
        </button>
        <a id="btnTrakteerPost" href="https://trakteer.id/NuranantoScanlation/posts" target="_blank" class="login-required-btn login-required-btn-trakteer">
          📖 Baca di Post Trakteer
        </a>
      </div>
      
      <button id="btnCloseLoginRequired" class="btn-close-modal">BATAL</button>
    </div>
  </div>
</div>

<!-- ✅ Modal Upgrade (untuk user sudah login tapi belum donatur) -->
<div id="upgradeModal" class="modal-overlay" style="display: none;">
  <div class="login-modal-content">
    <div class="upgrade-content">
      <h2 class="upgrade-title">⭐ UPGRADE KE DONATUR SETIA ⭐</h2>
<div class="benefits-list">
  <div class="benefit-item">✅ Akses semua chapter terkunci (locked)</div>
  <div class="benefit-item">✅ Badge DONATUR SETIA di akun Anda</div>
</div>
      
      <div class="upgrade-buttons">
        <button id="btnPanduan" class="upgrade-btn upgrade-btn-panduan">
          📖 PANDUAN WAJIB BACA!
        </button>
        <button id="btnDonasi" class="upgrade-btn upgrade-btn-trakteer">
          Donasi via Trakteer
          <span class="badge-instant">INSTANT</span>
        </button>
        <button id="btnVIPCode" class="upgrade-btn upgrade-btn-code">
          Punya DONATUR CODE?
        </button>
      </div>
      
      <button id="btnCloseUpgrade" class="btn-close-modal">BATAL</button>
    </div>
  </div>
</div>

<!-- Panduan Modal -->
<div id="panduanModal" class="modal-overlay" style="display: none;">
  <div class="login-modal-content">
    <div class="panduan-content">
      <h2 class="panduan-title">⚠️ BACA DULU ⚠️<br>Sebelum Donasi atau Input Code</h2>
      
      <div class="panduan-section">
        <h3 class="panduan-section-title">Donatur Code</h3>
        <ul class="panduan-list">
          <li>Input CODE → Redeem</li>
          <li>Status langsung DONATUR SETIA</li>
          <li>Chapter terkunci langsung terbuka di website</li>
        </ul>
        <p class="panduan-warning">⚠️ CODE TIDAK SELALU ADA<br>Dibagikan di waktu tertentu saja</p>
      </div>

      <div class="panduan-section">
        <h3 class="panduan-section-title">Donasi Lewat Trakteer</h3>
        <p class="panduan-warning-red">(WAJIB DIPAHAMI)</p>
        
        <div class="panduan-subsection">
          <h4 class="panduan-subtitle">✅ Donasi dengan menulis email login nuranantoscans.my.id</h4>
          <p class="panduan-text"><strong>Caranya:</strong></p>
          <ul class="panduan-list">
            <li>Tulis email login nuranantoscans.my.id di Pesan Dukungan Trakteer</li>
            <li>Pesan TIDAK DIPRIVASI (jangan aktifkan pesan privat)</li>
          </ul>
          <p class="panduan-text"><strong>Kekurangan:</strong></p>
          <ul class="panduan-list">
            <li>Email login terlihat oleh user lain</li>
          </ul>
          <p class="panduan-text"><strong>Kelebihan:</strong></p>
          <ul class="panduan-list">
            <li>Status otomatis DONATUR SETIA</li>
            <li>Semua locked chapter bisa dibaca langsung melalui website dan community post trakteer.</li>
          </ul>
        </div>

        <div class="panduan-subsection">
          <h4 class="panduan-subtitle">❌ Donasi tanpa menulis email login nuranantoscans.my.id / pesan dukungan diprivasi</h4>
          <p class="panduan-text"><strong>Kekurangan:</strong></p>
          <ul class="panduan-list">
            <li>Status tidak berubah (Masih Pembaca Setia)</li>
            <li>Status locked chapter di website tidak berubah</li>
            <li>Baca locked chapter harus lewat Community Post Trakteer</li>
            <li>Tidak semua locked chapter tersedia<br>(Webtoon / Longstrip hanya bisa dibaca di website)</li>
          </ul>
          <p class="panduan-text"><strong>Kelebihan:</strong></p>
          <ul class="panduan-list">
            <li>Email login tidak terlihat user lain</li>
          </ul>
        </div>
      </div>

      <button id="btnBackToUpgrade" class="upgrade-btn upgrade-btn-primary" style="width: 100%; margin-top: 8px;">
        ← Kembali ke Upgrade
      </button>
    </div>
  </div>
</div>

<!-- VIP Code Modal -->
<div id="codeModal" class="modal-overlay" style="display: none;">
  <div class="login-modal-content">
    <div class="code-content">
      <h2 class="code-title">Masukkan Donatur Code</h2>
      <form id="formVIPCode">
        <input type="text" id="inputVIPCode" placeholder="Masukkan kode Donatur Anda" required readonly>
        <p id="codeError" class="code-error"></p>
        <div class="code-buttons">
          <!-- ✅ Tombol PASTE (tampil dulu) -->
          <button type="button" id="btnPasteCode" class="btn-primary">
            📋 PASTE CODE
          </button>
          <!-- ✅ Tombol REDEEM (hidden dulu, muncul setelah paste) -->
          <button type="submit" id="btnRedeemCode" class="btn-primary" style="display: none;">
            ⚡ REDEEM CODE
          </button>
          <button type="button" id="btnBackFromCode" class="btn-secondary">BATAL</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- History Modal -->
<div id="historyModal" class="modal-overlay" style="display: none;" role="dialog" aria-modal="true">
  <div class="login-modal-content">
    <div class="history-content">
      <h2 class="history-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        History Baca
      </h2>
      
      <!-- Loading State -->
      <div id="historyLoading" class="history-loading">
        <div class="spinner" aria-hidden="true"></div>
        <p>Memuat history...</p>
      </div>
      
      <!-- History List -->
      <div id="historyList" class="history-list" style="display: none;"></div>
      
      <!-- Empty State -->
      <div id="historyEmpty" class="history-empty" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
        <p>Belum ada history</p>
        <small>Mulai baca manga untuk melihat history</small>
      </div>
      
      <button id="btnCloseHistory" class="btn-close-history">TUTUP</button>
    </div>
  </div>
</div>
    </body>
</html>
